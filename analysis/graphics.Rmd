---
title: "Figure Scripts"
author: "LucianoRogerio"
date: "2022-01-25"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---


## Results IITA Breeding Scheme Simulation with and without Genomic Selection


### F1

```{r, eval = F}
library(here); suppressMessages(library(tidyverse))

postBurnInIITAGS <- readRDS(here::here("output", "postBurnIn_IITA_GS.rds"))
postBurnInIITAPS <- readRDS(here::here("output", "postBurnIn_IITA_PS.rds"))

forSimPlotIITAF1 <- postBurnInIITAGS %>% 
              mutate(PostBurnIn = "GS") %>% 
              bind_rows(postBurnInIITAPS %>% 
              mutate(PostBurnIn = "PS")) %>% 
              unnest_wider(SimOutput) %>% 
              select(SimRep, PostBurnIn, records) %>% 
              unnest_wider(records) %>% 
              select(SimRep, PostBurnIn, stageOutputs) %>% 
              unnest(cols = stageOutputs) %>% 
              filter(stage == "F1") %>%
  mutate(YearPostBurnIn = year - 20)

saveRDS(forSimPlotIITAF1, here::here("output", "DataSimPlotIITA_F1.rds"))
rm(forSimPlotIITAF1)
```

### Last Stage

```{r, eval = F}
forSimPlotIITAUYT2 <- postBurnInIITAGS %>% 
              mutate(PostBurnIn = "GS") %>% 
              bind_rows(postBurnInIITAPS %>% 
              mutate(PostBurnIn = "PS")) %>% 
              unnest_wider(SimOutput) %>% 
              select(SimRep, PostBurnIn, records) %>% 
              unnest_wider(records) %>% 
              select(SimRep, PostBurnIn, stageOutputs) %>% 
              unnest(cols = stageOutputs) %>% 
              filter(stage == "UYT2") %>%
  mutate(YearPostBurnIn = year - 20)

saveRDS(forSimPlotIITAUYT2, here::here("output", "DataSimPlotIITA_UYT2.rds"))
rm(postBurnInIITAGS); rm(postBurnInIITAPS); rm(forSimPlotIITAUYT2)
```


## Results IITA 1ยบ alternative Breeding Scheme Simulation with and without Genomic Selection


### F1

```{r, eval = F}
library(here); suppressMessages(library(tidyverse))

postBurnInIITAGS <- readRDS(here::here("output", "postBurnIn_NVDP_IITA_GS.rds"))
postBurnInIITAPS <- readRDS(here::here("output", "postBurnIn_NVDP_IITA_PS.rds"))

forSimPlotIITA_NVDP_F1 <- postBurnInIITAGS %>% 
              mutate(PostBurnIn = "GS") %>% 
              bind_rows(postBurnInIITAPS %>% 
              mutate(PostBurnIn = "PS")) %>% 
              unnest_wider(SimOutput) %>% 
              select(SimRep, PostBurnIn, records) %>% 
              unnest_wider(records) %>% 
              select(SimRep, PostBurnIn, stageOutputs) %>% 
              unnest(cols = stageOutputs) %>% 
              filter(stage == "F1") %>%
  mutate(YearPostBurnIn = year - 20)

saveRDS(forSimPlotIITA_NVDP_F1, here::here("output", "DataSimPlotIITA_NVDP_F1.rds"))
rm(forSimPlotIITA_NVDP_F1)
```


### Last Stage

```{r, eval = F}
postBurnInIITAGS <- readRDS(here::here("output", "postBurnIn_NVDP_IITA_GS.rds"))
postBurnInIITAPS <- readRDS(here::here("output", "postBurnIn_NVDP_IITA_PS.rds"))

forSimPlotIITA_NVDP_UYT1 <- postBurnInIITAGS %>% 
              mutate(PostBurnIn = "GS") %>% 
              bind_rows(postBurnInIITAPS %>% 
              mutate(PostBurnIn = "PS")) %>% 
              unnest_wider(SimOutput) %>% 
              select(SimRep, PostBurnIn, records) %>% 
              unnest_wider(records) %>% 
              select(SimRep, PostBurnIn, stageOutputs) %>% 
              unnest(cols = stageOutputs) %>% 
              filter((stage == "UYT2" & year < 20) | (stage == "UYT1" & year >= 20)) %>%
  mutate(YearPostBurnIn = year - 20)

saveRDS(forSimPlotIITA_NVDP_UYT1, here::here("output", "DataSimPlotIITA_NVDP_UYT1.rds"))
rm(postBurnInIITAGS); rm(postBurnInIITAPS); rm(forSimPlotIITA_NVDP_UYT1)
```

## Results IITA 2ยบ alternative Breeding Scheme Simulation with and without Genomic Selection


### F1

```{r, eval = F}
library(here); suppressMessages(library(tidyverse))

postBurnInIITAGS <- readRDS(here::here("output", "postBurnIn_NVDP2_IITA_GS.rds"))
postBurnInIITAPS <- readRDS(here::here("output", "postBurnIn_NVDP2_IITA_PS.rds"))

forSimPlotIITA_NVDP2_F1 <- postBurnInIITAGS %>% 
              mutate(PostBurnIn = "GS") %>% 
              bind_rows(postBurnInIITAPS %>% 
              mutate(PostBurnIn = "PS")) %>% 
              unnest_wider(SimOutput) %>% 
              select(SimRep, PostBurnIn, records) %>% 
              unnest_wider(records) %>% 
              select(SimRep, PostBurnIn, stageOutputs) %>% 
              unnest(cols = stageOutputs) %>% 
              filter(stage == "F1") %>%
  mutate(YearPostBurnIn = year - 20)



saveRDS(forSimPlotIITA_NVDP2_F1, here::here("output", "DataSimPlotIITA_NVDP2_F1.rds"))
rm(forSimPlotIITA_NVDP2_F1)
```


### Last Stage

```{r, eval = F}
postBurnInIITAGS <- readRDS(here::here("output", "postBurnIn_NVDP_IITA_GS.rds"))
postBurnInIITAPS <- readRDS(here::here("output", "postBurnIn_NVDP_IITA_PS.rds"))

forSimPlotIITA_NVDP2_AYT <- postBurnInIITAGS %>% 
              mutate(PostBurnIn = "GS") %>% 
              bind_rows(postBurnInIITAPS %>% 
              mutate(PostBurnIn = "PS")) %>% 
              unnest_wider(SimOutput) %>% 
              select(SimRep, PostBurnIn, records) %>% 
              unnest_wider(records) %>% 
              select(SimRep, PostBurnIn, stageOutputs) %>% 
              unnest(cols = stageOutputs) %>% 
              filter((stage == "UYT2" & year < 20) | (stage == "AYT" & year >= 20)) %>%
  mutate(YearPostBurnIn = year - 20)
table(forSimPlotIITA_NVDP2_AYT$year, forSimPlotIITA_NVDP2_AYT$stage)

saveRDS(forSimPlotIITA_NVDP2_AYT, here::here("output", "DataSimPlotIITA_NVDP2_AYT.rds"))
rm(postBurnInIITAGS); rm(postBurnInIITAPS); rm(forSimPlotIITA_NVDP2_AYT)
```

## Joint all the data in two files

One for F1 results, and one for the last stage of it breeding scheme

### F1 Results
```{r, eval = TRUE}
library(here); suppressMessages(library(tidyverse))

IITA_F1 <- readRDS(here::here("output", "DataSimPlotIITA_F1.rds"))
NVDP1_F1 <- readRDS(here::here("output", "DataSimPlotIITA_NVDP_F1.rds"))
NVDP2_F1 <- readRDS(here::here("output", "DataSimPlotIITA_NVDP2_F1.rds"))

F1Res <- IITA_F1 %>% mutate(BS = "IITA") %>%
  bind_rows(NVDP1_F1 %>%
              mutate(BS = "NVDP1")) %>%
  bind_rows(NVDP2_F1 %>% mutate(BS = "NVDP2"))

saveRDS(F1Res, file = here::here("output", "F1ResultsIITA.rds"))
```

### Last Stage Results
```{r, eval = TRUE}

IITA_UYT2 <- readRDS(here::here("output", "DataSimPlotIITA_UYT2.rds"))
NVDP1_UYT1 <- readRDS(here::here("output", "DataSimPlotIITA_NVDP_UYT1.rds"))
NVDP2_AYT <- readRDS(here::here("output", "DataSimPlotIITA_NVDP2_AYT.rds"))

LSRes <- IITA_UYT2 %>% mutate(BS = "IITA") %>%
  bind_rows(NVDP1_UYT1 %>%
              mutate(BS = "NVDP1")) %>%
  bind_rows(NVDP2_AYT %>% mutate(BS = "NVDP2"))

saveRDS(LSRes, file = here::here("output", "LastStageResultsIITA.rds"))
```

[Home](VD_Optimization.html)
