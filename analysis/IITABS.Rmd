---
title: "IITA Breeding Scheme"
author: "LucianoRogerio"
date: "2022-01-26"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---


## Simulations with the IITA Breeding Scheme

<br />

| FunctionsArg  | FunctionName         |
| :-----------: | :------------------: |
| selCritPop    | parentSelCritBLUP    |
| selCritPipe   | productSelCritBLUP   |
| productFunc   | productPipeline      |
| popImprovFunc | popImprovByParentSel |
|               |                      |

<br />

#### Open R inside a singularity container

```{bash, eval = F}
screen -R LucianoSim;

# as I runned on Robbins Server I got to ask access to slurm

salloc -n 8 --mem 80G;

cd /workdir/lbraatz

singularity shell -B /programs rocker2.sif

R
```


#### Run R inside a singularity container

```{r, eval = F}

.libPaths(c(.libPaths(), "/programs/R-4.1.2/library/", "/home/lbraatz/R/x86_64-pc-linux-gnu-library/4.1/"))


library(devtools)
library(AlphaSimR)
library(AlphaSimHlpR)

suppressMessages(library(tidyverse))
suppressMessages(library(genomicMateSelectR))
library(dplyr); library(furrr); library(here)
library(RhpcBLASctl)

select <- dplyr::select
mutate <- dplyr::mutate

schemeDF <- read.csv(here::here("data","baselineScheme - IITA.csv"), 
                     header = T, stringsAsFactors = F, sep = ";")

bsp1 <- specifyBSP(schemeDF = schemeDF,
                   nTrainPopCycles = 8, nYrsAsCandidates = 3, maxTrainingPopSize = 6620,
                   nChr = 18, effPopSize = 200, quickHaplo = F,
                   segSites = 1650, nQTL = 1000, nSNP = 500, genVar = 1500,
                   gxeVar = NULL, gxyVar = 1500, gxlVar = 750, gxyxlVar = 300,
                   meanDD = 0.23, varDD = 0.05, relAA = 0.5,
                   stageToGenotype = "AYT",  RmStagePhen = "SDN",
                   nParents = 100, nCrosses = 400, nProgeny = 30, nClonesToNCRP = 3,
                   phenoF1toStage1 = F, errVarPreStage1 = 17500,
                   useCurrentPhenoTrain = F,
                   nCyclesToKeepRecords = 4,
                   selCritPipeAdv = selCritIID,
                   selCritPopImprov =  selCritIID)

source(here::here("code","runSchemesPostBurnIn.R"))

nRepT <- readRDS(here::here("output", "BurnIn_IITA.rds")) %>% nrow()
NCT <- RhpcBLASctl::get_num_procs()
nRepMap <- 5
reps <- c(rep(1:ceiling(nRepT/nRepMap), each = nRepMap))[1:nRepT]


set.seed(501)

for(i in 1:max(reps)) {

burnIn_IITA_PS <- readRDS(here::here("output", "BurnIn_IITA.rds")) %>% .[reps==i,]
start <- proc.time()[3]
postBurnIn_IITA_PS <- runSchemesPostBurnIn(simulations = burnIn_IITA_PS,
                                           newBSP = bsp1,
                                           nPostBurnInCycles = 12,
                                           selCritPop = "parentSelCritBLUP",
                                           selCritPipe = "productSelCritBLUP",
                                           productFunc = "productPipelinePostBurnIn",
                                           popImprovFunc = "popImprovByParentSel",
                                           nSimCores = nRepMap,
                                           nBLASthreads = ifelse(test = ((NCT %% nrow(burnIn_IITA_PS)) == 0),
                                                            yes = floor((NCT - 1) / nrow(burnIn_IITA_PS)),
                                                            no = floor(NCT / nrow(burnIn_IITA_PS))))
end <- proc.time()[3]; print(paste0(floor((end - start)/60), "mins ", floor(((end - start)%%60)), "s elapsed - bspP"))

RdsName <- paste("postBurnIn_IITA_PS", i, ".rds", sep = "")
saveRDS(postBurnIn_IITA_PS,file = here::here("output", RdsName))
rm(postBurnIn_IITA_PS); rm(RdsName); rm(burnIn_IITA_PS)
}

xx <- readRDS(here::here("output", "postBurnIn_IITA_PS1.rds"))

xxx <- xx$SimOutput[[1]]$records$PopImprov$grmData[[27]] %>% filter(pop =="c")

table(xxx$stage)
sum(is.na(xxx$gebv))
```

```
 ****** 1 to 8
 [1] "25mins 45s elapsed - bspP"

 ****** 9 to 16
 [1] "25mins 52s elapsed - bspP"

 ****** 17 to 24


 ****** 25 to 32
 [1] "26mins 18s elapsed - bspP"

 ****** 33 to 40
 [1] "25mins 54s elapsed - bspP"
 
```


joint all the Results in a same rds File
```{r, eval = FALSE}
suppressMessages(library(tidyverse))
RhpcBLASctl::blas_set_num_threads(80)
files <- here::here("output", dir("output")[grep(pattern = "postBurnIn_IITA_PS*", dir("output"))])
SimResults <- NULL
for(i in files){
  Results <- readRDS(i)
  SimResults <- rbind(SimResults, Results)  
  rm(Results)
}

saveRDS(SimResults, file = here::here("output", "postBurnIn_IITA_PS.rds"))
drm(SimResults)
```
####  With Genomic Selection
<br />

| FunctionsArg  | FunctionName         |
| :-----------: | :------------------: |
| selCritPop    | parentSelCritGEBV    |
| selCritPipe   | productSelCritBLUP   |
| productFunc   | productPipeline      |
| popImprovFunc | popImprovByParentSel |
|               |                      |

###### Parameters Changuing in different scenarios

- 3 Yrs as Candidates - cbsu lm35 - screen IITA3Yr

<br />

```{r 3Yrs Cand, eval = F}
.libPaths(c(.libPaths(), "/programs/R-4.1.2/library/", "/home/lbraatz/R/x86_64-pc-linux-gnu-library/4.1/"))


library(devtools)
library(AlphaSimR)
library(AlphaSimHlpR)

suppressMessages(library(tidyverse))
suppressMessages(library(genomicMateSelectR))
library(dplyr); library(furrr); library(here)
library(RhpcBLASctl)

select <- dplyr::select
mutate <- dplyr::mutate
AlphaSimHlpR::popImprovOutput

schemeDF <- read.csv(here::here("data","baselineScheme - IITA.csv"), 
                     header = T, stringsAsFactors = F, sep = ";")

bsp1 <- specifyBSP(schemeDF = schemeDF,
                   nTrainPopCycles = 5, nYrsAsCandidates = 3, maxTrainingPopSize = 6620,
                   nChr = 18, effPopSize = 200, quickHaplo = F,
                   segSites = 1650, nQTL = 1000, nSNP = 500, genVar = 1500,
                   gxeVar = NULL, gxyVar = 1500, gxlVar = 750, gxyxlVar = 300,
                   meanDD = 0.23, varDD = 0.05, relAA = 0.5,
                   stageToGenotype = "CET",
                   RmStagePhen = "SDN",
                   nParents = 100, nCrosses = 400, nProgeny = 30, nClonesToNCRP = 3,
                   parentsFlowering = 100,
                   TrainPopSel = "trainPopSelNew",
                   phenoF1toStage1 = F, errVarPreStage1 = 17500,
                   useCurrentPhenoTrain = F,
                   nCyclesToKeepRecords = 5,
                   selCritPipeAdv = selCritIID,
                   selCritPopImprov =  selCritIID)

source(here::here("code","runSchemesPostBurnIn.R"))

nRepT <- 40#readRDS(here::here("output", "BurnIn_IITA.rds")) %>% nrow()
NCT <- RhpcBLASctl::get_num_procs()
nRepMap <- 8
reps <- c(rep(1:ceiling(nRepT/nRepMap), each = nRepMap))[1:nRepT]

for(i in 1:ceiling(nRepT/nRepMap)) {

burnIn_IITA_PS <- readRDS(here::here("output", "BurnIn_IITA.rds")) %>% .[reps==i,]
start <- proc.time()[3]
postBurnIn_IITA_GS <- runSchemesPostBurnIn(simulations = burnIn_IITA_PS,
                                           newBSP = bsp1,
                                           nPostBurnInCycles = 12,
                                           selCritPop = "parentSelCritGEBV",
                                           selCritPipe = "productSelCritBLUP",
                                           productFunc = "productPipelinePostBurnIn",
                                           popImprovFunc = "popImprovByParentSel",
                                           nSimCores = nRepMap,
                                           nBLASthreads = ifelse(test = ((NCT %% nrow(burnIn_IITA_PS)) == 0),
                                                            yes = floor((NCT - 1) / nrow(burnIn_IITA_PS)),
                                                            no = floor(NCT / nrow(burnIn_IITA_PS))))
end <- proc.time()[3]; print(paste0(floor((end - start)/60), "mins ", floor(((end - start)%%60)), "s elapsed - bspP"))

RdsName <- paste("postBurnIn_IITA_GS_3Yrs", i, ".rds", sep = "")
saveRDS(postBurnIn_IITA_GS,file = here::here("output", RdsName))
rm(postBurnIn_IITA_GS); rm(RdsName); rm(burnIn_IITA_PS)
}
```

```
 ****** 1 to 8
 [1] "195mins 55s elapsed - bspP"
 
 ****** 9 to 16
  [1] "158mins 32s elapsed - bspP"

 ****** 17 to 24
  [1] "185mins 6s elapsed - bspP"
  
 ****** 25 to 32
 
 ****** 33 to 40

```

joint all the Results in a same rds File
```{r Joint Simulation Results 3Yrs, eval = FALSE}
suppressMessages(library(tidyverse))
RhpcBLASctl::blas_set_num_threads(6060)
files <- dir()[grep(pattern = "postBurnIn_IITA_GS_3Yrs*", dir())]
SimResults <- NULL
for(i in files){
  Results <- readRDS(i)
  SimResults <- rbind(SimResults, Results)  
  rm(Results)
}

saveRDS(SimResults, file = "postBurnIn_IITA_GS_3Yrs.rds")
rm(SimResults)
```

### Obtain the ratio of Parent selected per stage

```{r Parent Selection origin 3Yrs, eval = FALSE}
library(tidyverse); library(AlphaSimR)
library(here)
schemeDF <- read.csv(here::here("data","baselineScheme - IITA.csv"), 
                     header = T, stringsAsFactors = F, sep = ";")
simulations <- readRDS(here::here("output", "postBurnIn_IITA_GS_3Yrs.rds"))

RelPar <- tibble()
for(repl in 1:nrow(simulations)){
  
  SP <- simulations$SimOutput[[repl]]$SP
  F1s <- tibble(id = simulations$SimOutput[[repl]]$records$F1@id,
                mother = simulations$SimOutput[[repl]]$records$F1@mother,
                father = simulations$SimOutput[[repl]]$records$F1@father,
                Year = simulations$SimOutput[[repl]]$records$F1@fixEff,
                gv = simulations$SimOutput[[repl]]$records$F1@gv,
                bv = bv(simulations$SimOutput[[repl]]$records$F1))
  
  
  for(year in 1:length(simulations$SimOutput[[repl]]$records$SDN)){
    
    progeny <- tibble(simulations$SimOutput[[repl]]$records$SDN[[year]],
                      Year = year) %>% filter(isChk != "check")
    parents <- tibble(id = unique(union(progeny$father,progeny$mother)) %>% .[order(as.numeric(.))])
    
    ProgenyInfo <- progeny %>% select(id) %>% left_join(F1s, by = "id") %>% select(c(id,Year))
    ParentsInfo <- parents %>% left_join(F1s, by = "id") %>%
      mutate(Stage = schemeDF$stageNames[unique(ProgenyInfo$Year) - as.numeric(Year)],
             Year = unique(ProgenyInfo$Year),
             Rep = repl) %>% select(c(Rep, Year, Stage, id, bv, gv, mother, father))
    
    RelPar <- bind_rows(RelPar, ParentsInfo)
    rm(progeny); rm(parents); rm(ProgenyInfo); rm(ParentsInfo)
  }
  rm(SP); rm(F1s)
}

write.table(x = RelPar, file = here::here("output", "ParentOriginGS_3Yrs.csv"),
            sep = ",", quote = FALSE,
            row.names = FALSE, col.names = TRUE)
```

- 2 Yrs as Candidate - CBSU lm32 - screen IITA2Yr

<br />

```{r 2Yrs Cand, eval = F}
.libPaths(c(.libPaths(), "/programs/R-4.1.2/library/", "/home/lbraatz/R/x86_64-pc-linux-gnu-library/4.1/"))


library(devtools)
library(AlphaSimR)
library(AlphaSimHlpR)

suppressMessages(library(tidyverse))
suppressMessages(library(genomicMateSelectR))
library(dplyr); library(furrr); library(here)
library(RhpcBLASctl)

select <- dplyr::select
mutate <- dplyr::mutate

schemeDF <- read.csv(here::here("data","baselineScheme - IITA.csv"), 
                     header = T, stringsAsFactors = F, sep = ";")

bsp1 <- specifyBSP(schemeDF = schemeDF,
                   nTrainPopCycles = 5, nYrsAsCandidates = 2, maxTrainingPopSize = 6700,
                   nChr = 18, effPopSize = 200, quickHaplo = F,
                   segSites = 1650, nQTL = 1000, nSNP = 500, genVar = 1500,
                   gxeVar = NULL, gxyVar = 1500, gxlVar = 750, gxyxlVar = 300,
                   meanDD = 0.23, varDD = 0.05, relAA = 0.5,
                   stageToGenotype = "CET",
                   RmStagePhen = "SDN",
                   nParents = 100, nCrosses = 400, nProgeny = 30, nClonesToNCRP = 3,
                   parentsFlowering = 100,
                   TrainPopSel = "trainPopSelNew",
                   phenoF1toStage1 = F, errVarPreStage1 = 17500,
                   useCurrentPhenoTrain = F,
                   nCyclesToKeepRecords = 5,
                   selCritPipeAdv = selCritIID,
                   selCritPopImprov =  selCritIID)

source(here::here("code","runSchemesPostBurnIn.R"))

nRepT <- 40#readRDS(here::here("output", "BurnIn_IITA.rds")) %>% nrow()
NCT <- RhpcBLASctl::get_num_procs()
nRepMap <- 8
reps <- c(rep(1:ceiling(nRepT/nRepMap), each = nRepMap))[1:nRepT]

for(i in 1:ceiling(nRepT/nRepMap)) {

burnIn_IITA_PS <- readRDS(here::here("output", "BurnIn_IITA.rds")) %>% .[reps==i,]
start <- proc.time()[3]
postBurnIn_IITA_GS <- runSchemesPostBurnIn(simulations = burnIn_IITA_PS,
                                           newBSP = bsp1,
                                           nPostBurnInCycles = 12,
                                           selCritPop = "parentSelCritGEBV",
                                           selCritPipe = "productSelCritBLUP",
                                           productFunc = "productPipelinePostBurnIn",
                                           popImprovFunc = "popImprovByParentSel",
                                           nSimCores = nRepMap,
                                           nBLASthreads = ifelse(test = ((NCT %% nrow(burnIn_IITA_PS)) == 0),
                                                            yes = floor((NCT - 1) / nrow(burnIn_IITA_PS)),
                                                            no = floor(NCT / nrow(burnIn_IITA_PS))))
end <- proc.time()[3]; print(paste0(floor((end - start)/60), "mins ", floor(((end - start)%%60)), "s elapsed - bspP"))

RdsName <- paste("postBurnIn_IITA_GS_2Yrs", i, ".rds", sep = "")
saveRDS(postBurnIn_IITA_GS,file = here::here("output", RdsName))
rm(postBurnIn_IITA_GS); rm(RdsName); rm(burnIn_IITA_PS)
}
```

```
 ****** 1 to 8
  [1] "182mins 20s elapsed - bspP"

 ****** 9 to 16
  [1] "179mins 0s elapsed - bspP"
  
 ****** 17 to 24
  [1] "182mins 39s elapsed - bspP"
  
 ****** 25 to 32

 ****** 33 to 40

```

joint all the Results in a same rds File
```{r Joint Simulations Results 2Yrs, eval = FALSE}
suppressMessages(library(tidyverse))
RhpcBLASctl::blas_set_num_threads(60)
files <- dir()[grep(pattern = "postBurnIn_IITA_GS_2Yrs*", dir())]
SimResults <- NULL
for(i in files){
  Results <- readRDS(i)
  SimResults <- rbind(SimResults, Results)  
  rm(Results)
}

saveRDS(SimResults, file = "postBurnIn_IITA_GS_2Yrs.rds")
rm(SimResults)
```

### Obtain the ratio of Parent selected per stage

```{r Parent Selection origin 2Yrs, eval = FALSE}
library(tidyverse); library(AlphaSimR)
library(here)
schemeDF <- read.csv(here::here("data","baselineScheme - IITA.csv"), 
                     header = T, stringsAsFactors = F, sep = ";")
simulations <- readRDS(here::here("output", "postBurnIn_IITA_GS_2Yrs.rds"))

RelPar <- tibble()
for(repl in 1:nrow(simulations)){
  
  SP <- simulations$SimOutput[[repl]]$SP
  F1s <- tibble(id = simulations$SimOutput[[repl]]$records$F1@id,
                mother = simulations$SimOutput[[repl]]$records$F1@mother,
                father = simulations$SimOutput[[repl]]$records$F1@father,
                Year = simulations$SimOutput[[repl]]$records$F1@fixEff,
                gv = simulations$SimOutput[[repl]]$records$F1@gv,
                bv = bv(simulations$SimOutput[[repl]]$records$F1))
  
  
  for(year in 1:length(simulations$SimOutput[[repl]]$records$SDN)){
    
    progeny <- tibble(simulations$SimOutput[[repl]]$records$SDN[[year]],
                      Year = year) %>% filter(isChk != "check")
    parents <- tibble(id = unique(union(progeny$father,progeny$mother)) %>% .[order(as.numeric(.))])
    
    ProgenyInfo <- progeny %>% select(id) %>% left_join(F1s, by = "id") %>% select(c(id,Year))
    ParentsInfo <- parents %>% left_join(F1s, by = "id") %>%
      mutate(Stage = schemeDF$stageNames[unique(ProgenyInfo$Year) - as.numeric(Year)],
             Year = unique(ProgenyInfo$Year),
             Rep = repl) %>% select(c(Rep, Year, Stage, id, bv, gv, mother, father))
    
    RelPar <- bind_rows(RelPar, ParentsInfo)
    rm(progeny); rm(parents); rm(ProgenyInfo); rm(ParentsInfo)
  }
  rm(SP); rm(F1s)
}

write.table(x = RelPar, file = here::here("output", "ParentOriginGS_2Yrs.csv"),
            sep = ",", quote = FALSE,
            row.names = FALSE, col.names = TRUE)
```

- 1 Yrs as Candidate - CBSU lm31 - screen IITA1Yr

<br />

```{r 1Yr Cand, eval = F}
.libPaths(c(.libPaths(), "/programs/R-4.1.2/library/", "/home/lbraatz/R/x86_64-pc-linux-gnu-library/4.1/"))


library(devtools)
library(AlphaSimR)
library(AlphaSimHlpR)

suppressMessages(library(tidyverse))
suppressMessages(library(genomicMateSelectR))
library(dplyr); library(furrr); library(here)
library(RhpcBLASctl)

select <- dplyr::select
mutate <- dplyr::mutate

schemeDF <- read.csv(here::here("data","baselineScheme - IITA.csv"), 
                     header = T, stringsAsFactors = F, sep = ";")

bsp1 <- specifyBSP(schemeDF = schemeDF,
                   nTrainPopCycles = 5, nYrsAsCandidates = 1, maxTrainingPopSize = 7500,
                   nChr = 18, effPopSize = 200, quickHaplo = F,
                   segSites = 1650, nQTL = 1000, nSNP = 500, genVar = 1500,
                   gxeVar = NULL, gxyVar = 1500, gxlVar = 750, gxyxlVar = 300,
                   meanDD = 0.23, varDD = 0.05, relAA = 0.5,
                   stageToGenotype = "CET",
                   RmStagePhen = "SDN",
                   nParents = 100, nCrosses = 400, nProgeny = 30, nClonesToNCRP = 3,
                   parentsFlowering = 100,
                   TrainPopSel = "trainPopSelNew",
                   phenoF1toStage1 = F, errVarPreStage1 = 17500,
                   useCurrentPhenoTrain = F,
                   nCyclesToKeepRecords = 5,
                   selCritPipeAdv = selCritIID,
                   selCritPopImprov =  selCritIID)

source(here::here("code","runSchemesPostBurnIn.R"))

nRepT <- 40#readRDS(here::here("output", "BurnIn_IITA.rds")) %>% nrow()
NCT <- RhpcBLASctl::get_num_procs()
nRepMap <- 8
reps <- c(rep(1:ceiling(nRepT/nRepMap), each = nRepMap))[1:nRepT]

for(i in 1:ceiling(nRepT/nRepMap)) {

burnIn_IITA_PS <- readRDS(here::here("output", "BurnIn_IITA.rds")) %>% .[reps==i,]
start <- proc.time()[3]
postBurnIn_IITA_GS <- runSchemesPostBurnIn(simulations = burnIn_IITA_PS,
                                           newBSP = bsp1,
                                           nPostBurnInCycles = 12,
                                           selCritPop = "parentSelCritGEBV",
                                           selCritPipe = "productSelCritBLUP",
                                           productFunc = "productPipelinePostBurnIn",
                                           popImprovFunc = "popImprovByParentSel",
                                           nSimCores = nRepMap,
                                           nBLASthreads = ifelse(test = ((NCT %% nrow(burnIn_IITA_PS)) == 0),
                                                            yes = floor((NCT - 1) / nrow(burnIn_IITA_PS)),
                                                            no = floor(NCT / nrow(burnIn_IITA_PS))))
end <- proc.time()[3]; print(paste0(floor((end - start)/60), "mins ", floor(((end - start)%%60)), "s elapsed - bspP"))

RdsName <- paste("postBurnIn_IITA_GS_1Yrs", i, ".rds", sep = "")
saveRDS(postBurnIn_IITA_GS,file = here::here("output", RdsName))
rm(postBurnIn_IITA_GS); rm(RdsName); rm(burnIn_IITA_PS)
}
```


```
 ****** 1 to 8
  [1] "148mins 17s elapsed - bspP"

 ****** 9 to 16
  [1] "164mins 36s elapsed - bspP"
 
 ****** 17 to 24
  [1] "182mins 20s elapsed - bspP"
  
 ****** 25 to 32
 
 ****** 33 to 40
```

joint all the Results in a same rds File
```{r Joint Simulations Results 1Yr, eval = FALSE}
suppressMessages(library(tidyverse))
RhpcBLASctl::blas_set_num_threads(80)
files <- dir()[grep(pattern = "postBurnIn_IITA_GS_1Yrs*", dir())]
SimResults <- NULL
for(i in files){
  Results <- readRDS(i)
  SimResults <- rbind(SimResults, Results)  
  rm(Results)
}

saveRDS(SimResults, file = "postBurnIn_IITA_GS_1Yr.rds")
rm(SimResults)
```

### Obtain the ratio of Parent selected per stage

```{r Parent Selection origin 1Yr, eval = FALSE}
library(tidyverse); library(AlphaSimR)
library(here)
schemeDF <- read.csv(here::here("baselineScheme - IITA.csv"), 
                     header = T, stringsAsFactors = F, sep = ";")
simulations <- readRDS(here::here("postBurnIn_IITA_GS_1Yr.rds"))

RelPar <- tibble()
for(repl in 1:nrow(simulations)){
  
  SP <- simulations$SimOutput[[repl]]$SP
  F1s <- tibble(id = simulations$SimOutput[[repl]]$records$F1@id,
                mother = simulations$SimOutput[[repl]]$records$F1@mother,
                father = simulations$SimOutput[[repl]]$records$F1@father,
                year = simulations$SimOutput[[repl]]$records$F1@fixEff,
                gv = simulations$SimOutput[[repl]]$records$F1@gv,
                bv = bv(simulations$SimOutput[[repl]]$records$F1))
  
  
  for(Year in 1:5){
    
    progeny <- tibble(simulations$SimOutput[[repl]]$records$SDN[[Year]]) %>% filter(isChk != "check")
    parents <- tibble(id = unique(union(progeny$father,progeny$mother)) %>% .[order(as.numeric(.))])
    
    ProgenyInfo <- progeny %>% select(id) %>% left_join(F1s, by = "id") %>% select(c(id,year))
    ParentsInfo <- parents %>% left_join(F1s, by = "id") %>%
      mutate(Stage = schemeDF$stageNames[unique(ProgenyInfo$year) - (as.numeric(year))],
             Year = unique(ProgenyInfo$year),
             Rep = repl) %>% select(c(Rep, Year, Stage, id, bv, gv, mother, father))
    
    RelPar <- bind_rows(RelPar, ParentsInfo)
    rm(progeny); rm(parents); rm(ProgenyInfo); rm(ParentsInfo)
  }
  rm(SP); rm(F1s)
}

write.table(x = RelPar, file = here::here("output", "ParentOriginGS_1Yr.csv"),
            sep = ",", quote = FALSE,
            row.names = FALSE, col.names = TRUE)
for(repl in 1:nrow(simulations)){
  for(YEAR in length(simulations$SimOutput[[repl]]$records$PopImprov$grmData)){
RelPar <- rbind(RelPar,
                simulations$SimOutput[[repl]]$records$PopImprov$grmData[[YEAR]][simulations$SimOutput[[repl]]$records$PopImprov$grmData[[YEAR]]$pop == "c",])
}
}
```


[back](VD_Optimization.html)
